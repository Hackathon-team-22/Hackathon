## Реализованные функции приложения "Финансовый мониторинг"

Данный раздел описывает реализованную функциональность приложения "Финансовый мониторинг".

### 1. API

API предоставляет набор эндпоинтов для взаимодействия с приложением.  В текущей версии отсутствует пользовательский интерфейс (UI), поэтому API является основным способом взаимодействия.

#### 1.1. Аутентификация и авторизация

*   **`POST /auth/register`**: Регистрация нового пользователя.
    *   Запрос:
        ```json
        {
          "username": "string",
          "password": "string"
        }
        ```
    *   Ответ:
        *   Код `201 Created`: Успешная регистрация.

*   **`POST /auth/login`**: Авторизация существующего пользователя. Возвращает JWT (JSON Web Token) для аутентификации последующих запросов.
    *   Запрос:
        ```json
        {
          "username": "string",
          "password": "string"
        }
        ```
    *   Ответ:
        *   Код `200 OK`: Успешная авторизация.
        ```json
        {
          "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyMSIsImlhdCI6MTY5ODQxNjA4OCwiZXhwIjoxNjk4NDE5Njg4fQ.nF-b1_1I8s9K8v_5t_1d_9Fv_j0F_9J8g_J8d_J"
        }
        ```

#### 1.2. Управление транзакциями

Все эндпоинты в этом разделе требуют JWT в заголовке `Authorization: Bearer <token>`.

*   **`GET /transactions`**: Получение списка транзакций. Поддерживает фильтрацию через параметры запроса.
    *   Параметры фильтрации:
        *   `minAmount` (number): Минимальная сумма транзакции.
        *   `maxAmount` (number): Максимальная сумма транзакции.
        *   `fromDate` (string): Начальная дата периода (формат ISO 8601, например, `2023-10-26T00:00:00`).
        *   `toDate` (string): Конечная дата периода (формат ISO 8601, например, `2023-10-27T23:59:59`).
        *   `transactionTypeId` (UUID): UUID типа транзакции.
        *   `statusId` (UUID): UUID статуса транзакции.
        *   `categoryId` (UUID): UUID категории транзакции.
        *   `bankSenderId` (UUID): UUID банка отправителя.
        *   `bankReceiverId` (UUID): UUID банка получателя.
        *   `receiverTin` (string): ИНН получателя.
    *   Ответ:
        *   Код `200 OK`: Успешное получение списка транзакций.  (Возвращает JSON-массив объектов транзакций)

*   **`GET /transactions/{id}`**: Получение информации о конкретной транзакции по её ID.
    *   Параметры:
        *   `id` (UUID): ID транзакции.
    *   Ответ:
        *   Код `200 OK`: Успешное получение информации о транзакции. (Возвращает JSON-объект транзакции)
        *   Код `404 Not Found`: Транзакция с указанным ID не найдена.

*   **`POST /transactions`**: Создание новой транзакции.
    *   Запрос:
        ```json
        {
          "partyTypeId": "UUID",
          "transactionTypeId": "UUID",
          "statusId": "UUID",
          "bankSenderId": "UUID",
          "bankReceiverId": "UUID",
          "accountSender": "string",
          "accountReceiver": "string",
          "categoryId": "UUID",
          "timestamp": "string (ISO 8601)",
          "amount": number,
          "receiverTin": "string",
          "receiverPhone": "string",
          "comment": "string"
        }
        ```
    *   Ответ:
        *   Код `201 Created`: Успешное создание транзакции.

*   **`PUT /transactions/{id}`**: Обновление существующей транзакции.
    *   Параметры:
        *   `id` (UUID): ID транзакции.
    *   Запрос:  (Тот же формат, что и для `POST /transactions`)
        ```json
        {
          "partyTypeId": "UUID",
          "transactionTypeId": "UUID",
          "statusId": "UUID",
          "bankSenderId": "UUID",
          "bankReceiverId": "UUID",
          "accountSender": "string",
          "accountReceiver": "string",
          "categoryId": "UUID",
          "timestamp": "string (ISO 8601)",
          "amount": number,
          "receiverTin": "string",
          "receiverPhone": "string",
          "comment": "string"
        }
        ```
    *   Ответ:
        *   Код `200 OK`: Успешное обновление транзакции.
        *   Код `404 Not Found`: Транзакция с указанным ID не найдена.
        *   Код `400 Bad Request`: Некорректные данные в запросе.  (Например, попытка обновить транзакцию в недопустимом статусе)

*   **`DELETE /transactions/{id}`**: "Удаление" транзакции (фактически меняет её статус на "Удалено").
    *   Параметры:
        *   `id` (UUID): ID транзакции.
    *   Ответ:
        *   Код `204 No Content`: Успешное "удаление" транзакции.
        *   Код `404 Not Found`: Транзакция с указанным ID не найдена.
        *   Код `400 Bad Request`: Транзакцию нельзя удалить в текущем статусе.

#### 1.3. Дашборды

Все эндпоинты в этом разделе требуют JWT в заголовке `Authorization: Bearer <token>`.

*   **`GET /dashboard/transactions/count`**: Получение количества транзакций по периодам.
    *   Параметры:
        *   `period` (string, required):  Период времени. Допустимые значения: `week`, `month`, `quarter`, `year`.
    *   Ответ:
        *   Код `200 OK`: Успешное получение данных. (Возвращает JSON-объект с данными о количестве транзакций по периодам)

*   **`GET /dashboard/transactions/by-type`**: Получение динамики дебетовых и кредитовых транзакций.
    *   Параметры:
        *   `period` (string, required): Период времени. Допустимые значения: `week`, `month`, `quarter`, `year`.
        *   `type` (string): Тип транзакции. Допустимые значения: `debit`, `credit`.
    *   Ответ:
        *   Код `200 OK`: Успешное получение данных.

*   **`GET /dashboard/transactions/sums`**: Сравнение сумм поступлений и списаний.
    *   Параметры:
        *   `period` (string, required): Период времени. Допустимые значения: `week`, `month`, `quarter`, `year`.
    *   Ответ:
        *   Код `200 OK`: Успешное получение данных.

*   **`GET /dashboard/transactions/status-count`**: Получение количества проведённых и отменённых транзакций.
    *   Параметры:
        *   `period` (string, required): Период времени. Допустимые значения: `week`, `month`, `quarter`, `year`.
    *   Ответ:
        *   Код `200 OK`: Успешное получение данных.

*   **`GET /dashboard/transactions/by-bank`**: Получение статистики по банкам.
    *   Параметры:
        *   `period` (string, required): Период времени. Допустимые значения: `week`, `month`, `quarter`, `year`.
        *   `role` (string): Роль банка. Допустимые значения: `sender`, `receiver`.
    *   Ответ:
        *   Код `200 OK`: Успешное получение данных.

*   **`GET /dashboard/transactions/by-category`**: Получение расходов и поступлений по категориям.
    *   Параметры:
        *   `period` (string, required): Период времени. Допустимые значения: `week`, `month`, `quarter`, `year`.
        *   `type` (string): Тип категории. Допустимые значения: `income`, `outcome`.
    *   Ответ:
        *   Код `200 OK`: Успешное получение данных.

#### 1.4. Экспорт данных

Все эндпоинты в этом разделе требуют JWT в заголовке `Authorization: Bearer <token>`.

*   **`GET /export/transactions`**: Экспорт транзакций в CSV-формате.
    *   Параметры фильтрации: (Те же параметры, что и для `GET /transactions`)
        *   `minAmount` (number): Минимальная сумма транзакции.
        *   `maxAmount` (number): Максимальная сумма транзакции.
        *   `fromDate` (string): Начальная дата периода (формат ISO 8601).
        *   `toDate` (string): Конечная дата периода (формат ISO 8601).
        *   `transactionTypeId` (UUID): UUID типа транзакции.
        *   `statusId` (UUID): UUID статуса транзакции.
        *   `categoryId` (UUID): UUID категории транзакции.
        *   `bankSenderId` (UUID): UUID банка отправителя.
        *   `bankReceiverId` (UUID): UUID банка получателя.
        *   `receiverTin` (string): ИНН получателя.
    *   Заголовки:
        *   `Accept: text/csv`
    *   Ответ:
        *   Код `200 OK`: Успешный экспорт данных. (Возвращает CSV-файл)

*   **`GET /export/audit`**: Экспорт лога аудита в CSV-формате.
    *   Параметры: Отсутствуют.
    *   Ответ:
        *   Код `200 OK`: Успешный экспорт данных. (Возвращает CSV-файл)

### 2. Валидация данных

В приложении реализована валидация следующих данных:

*   **Формат даты:** Ожидается формат ISO 8601 (например, `2023-10-27T10:00:00`).
*   **ИНН:** Ожидается строка, состоящая из 11 цифр.
*   **Номер телефона:**  (Укажите формат номера телефона, если он проверяется. Например, начинается с +7 и состоит из 11 цифр.)
*   **UUID:**  Валидация UUID для полей, которые должны содержать UUID.
*   **Числовые значения:** Проверка на то, что сумма транзакции является числом.

### 3. Аудит изменений

Приложение ведет журнал аудита, в котором фиксируются изменения данных (в основном, транзакций).  Записи в журнале содержат информацию о:

*   Времени изменения.
*   Пользователе, внесшем изменения.
*   Типе действия (создание, обновление, удаление).
*   Типе сущности (например, "Transaction").
*   ID сущности.
*   Старом и новом значении (в формате JSON).

Данные аудита можно экспортировать в CSV-формате с помощью эндпоинта `GET /export/audit`.

---

**Примечания:**

*   UUID, используемые в примерах, представлены в виде `UUID`, их необходимо заменить на валидные UUID.
*   Этот документ описывает функциональность API.  Для работы с приложением рекомендуется использовать Swagger UI (http://localhost:8085/swagger-ui/index.html).

---
